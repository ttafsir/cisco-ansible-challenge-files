---
- name: TEST NTP
  hosts: vr-csr
  gather_facts: false

  tasks:
    - name: retrieve NTP Server Settings
      cisco.ios.ios_ntp_global:
        state: gathered
      register: gathered_ntp_config

    - name: assert that ntp servers match
      assert:
        that: gathered_ntp_config.gathered.servers|default(none) == ntp_config.servers
        fail_msg: "FAILURE: NTP Servers do not match. Expected: {{ ntp_config.servers }} Found: {{ gathered_ntp_config.gathered.servers | default(none) }}"

    - name: assert that ntp source matches
      assert:
        that: gathered_ntp_config.gathered.source|default(none) == ntp_config.source
        fail_msg: "FAILURE: NTP Servers do not match. Expected: {{ ntp_config.source }} Found: {{ gathered_ntp_config.gathered.source | default(none) }}"